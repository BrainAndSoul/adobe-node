{"version":3,"file":"app.js","sourceRoot":"","sources":["../src/app.ts"],"names":[],"mappings":"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","sourcesContent":["\r\n\r\nimport { AdobeAppEvent, AdobeAppProcess, CommandFileCreator as AdobeScriptCreator, CommandStack, Config, NewDocumentOptions, Options, AdobeApp, AdobeEventListener } from \"./api\";\r\nimport newAdobeAppListener from './listener';\r\nimport newAdobeAppProcess from './process';\r\nimport newCommandStack from './commands';\r\nimport newAdobeScriptCreator from './script-file-creator';\r\nimport { broadcast } from './broadcast';\r\n\r\nexport const newAdobeApp = (config: Config, timeoutCallback?: Function): AdobeApp => {\r\n\r\n  const scriptCreator: AdobeScriptCreator = newAdobeScriptCreator(config);\r\n  const commandStack: CommandStack = newCommandStack();\r\n  const eventListener: AdobeEventListener = newAdobeAppListener(config.host, config.port, eventListenerCallback);\r\n  const appProcess: AdobeAppProcess = newAdobeAppProcess(config.app.path, appCloseCallback, {\r\n    timeout: config.appTimeout,\r\n    timeoutCallback\r\n  });\r\n\r\n  function eventListenerCallback(commandName: string) {\r\n    commandStack.resolve(commandName);\r\n  }\r\n\r\n  function appCloseCallback() {\r\n    broadcast(config.host, config.port, { command: AdobeAppEvent.CloseApp });\r\n  }\r\n\r\n  function useBuiltInScript(command: string): boolean {\r\n    return command === AdobeAppEvent.CloseDocument \r\n      || command === AdobeAppEvent.SaveDocument\r\n      || command === AdobeAppEvent.SaveAndCloseDocument\r\n      || command === AdobeAppEvent.SaveAsDocument\r\n      || command === AdobeAppEvent.OpenDocument\r\n      || command === AdobeAppEvent.NewDocument\r\n      || command === AdobeAppEvent.SelectDocument;\r\n  }\r\n\r\n  const app: AdobeApp = {\r\n    init() {\r\n      eventListener.start();\r\n    },\r\n    on(event: string, callback: Function): AdobeApp {\r\n      eventListener.addEventListener(event, callback);\r\n      return app;\r\n    },\r\n\r\n    runScript: (command: string, options?: Options): Promise<any> =>\r\n      new Promise(async (resolve, reject) => {\r\n        const commandPath: string = await scriptCreator.create(command, useBuiltInScript(command), options);\r\n        commandStack.push({ command, resolve, reject });\r\n        appProcess.run(commandPath);\r\n      }),\r\n\r\n    saveDocument: (...documents: string[]): Promise<any> =>\r\n      app.runScript(AdobeAppEvent.SaveDocument, { documents }),\r\n    \r\n    selectDocument: (document: string): Promise<any> =>\r\n      app.runScript(AdobeAppEvent.SelectDocument, { document }),\r\n\r\n    saveAsDocument: (document: string, saveAs: string, options?: object): Promise<any> =>\r\n      app.runScript(AdobeAppEvent.SaveAsDocument, { document, saveAs, options }),\r\n\r\n    openDocument: (...documents: string[]): Promise<any> =>\r\n      app.runScript(AdobeAppEvent.OpenDocument, { documents }),\r\n\r\n    closeDocument: (...documents: string[]): Promise<any> =>\r\n      app.runScript(AdobeAppEvent.CloseDocument, { documents }),\r\n\r\n    saveAndCloseDocument: (...documents: string[]): Promise<any> =>\r\n      app.runScript(AdobeAppEvent.SaveAndCloseDocument, { documents }),\r\n\r\n    newDocument: (options?: NewDocumentOptions): Promise<any> =>\r\n      app.runScript(AdobeAppEvent.NewDocument, options),\r\n\r\n    open: (): Promise<any> => new Promise(async (resolve, reject) => {\r\n      const scriptPath = await scriptCreator.create(AdobeAppEvent.OpenApp)\r\n      appProcess.create(scriptPath);\r\n      commandStack.push({\r\n        command: AdobeAppEvent.OpenApp, resolve, reject\r\n      });\r\n    }),\r\n\r\n    close: (): Promise<void> => new Promise(async (resolve, reject) => {\r\n      appProcess.kill();\r\n      commandStack.push({\r\n        command: AdobeAppEvent.CloseApp, resolve, reject\r\n      });\r\n    }),\r\n    dispose: (): void => {\r\n      eventListener.close();\r\n    }\r\n  }\r\n\r\n  return app;\r\n}\r\n"]}